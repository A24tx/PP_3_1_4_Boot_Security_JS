<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>



<div>
	<!-- NAVBAR START  -->
	<nav class="navbar navbar-dark bg-dark static-top">

		<div class="container-fluid">
                        <span>
                            <span class="navbar-brand h5"  id="navbar-email"> </span>
                            <span class="navbar-text h5">with roles </span>
                            <span class="navbar-text h5" id="navbar-roles">
<!--                                <span>$Role</span>-->

                            </span>
                        </span>
			<a class="btn btn-secondary btn-dark " href="/logout" type="submit">Log out</a>
		</div>

	</nav>
	<!-- NAVBAR END -->
</div>


<div style="height: 39em" class="col-12 d-flex bg-light">
	<!-- MAIN CONTAINER -->
	<div class=" row container-fluid pt-3 ps-0 h-100 bg-light">




		<!-- side table -->
		<div class=" bg-body col-2 p-0 nav flex-column nav-pills">
			<div class="nav-item" id="userAndAdmin">
				<a class="nav-link active" href="/user">User</a>
			</div>
		</div>

		<!-- tabs with container-->

		<div class="bg-light ps-4 col-10 h-100">
			<p> <h2>User panel</h2> </p>

			<!-- tabs -->
<!--			<div class="row">-->

<!--				<ul class="nav nav-tabs" id="myTab" role="tablist">-->
<!--					<li class="nav-item" role="presentation">-->
<!--						<button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#userTableTab" type="button" role="tab" aria-controls="userTableTab" aria-selected="true">User Info</button>-->
<!--					</li>-->
<!--				</ul>-->

<!--			</div>-->




			<!-- users table -->
			<div class="row">
				<div class="tab-content border"  id="myTabContent">


					<!-- user table tab-->
					<div id="userTableTab" role="tabpanel" aria-labelledby="home-tab"  class="tab-pane fade show active">
						<div class="bg-body row">
							<p class ="bg-light fs-4 p-2 border-bottom"> Account details</p>
							<div>
								<table class="table table-striped ">

									<thead>
									<tr>
										<th scope="col">ID</th>
										<th scope="col">Email</th>
										<th scope="col">Username</th>
										<th scope="col">Role</th>
									</tr>
									</thead>
									<tbody id="my-table-body">
										<!-- QUERY DATA WILL BE INSERTED HERE -->
								</tbody>
								</table>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>



	</div>




</div>






<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>


<script>
	// on load
	$(document).ready(function() {
		loadUserInfo();
	});

	// получить текущего пользователя
	function loadUserInfo() {
		$.ajax({
			url: "http://localhost:8080/currentUser"
		}).then(function(data) {
			$('#navbar-email').append(data.username);
			$('#userAndAdmin a').remove()
			let sidetable = $('#userAndAdmin')
			let tableBody = $('#my-table-body');
			let isAdmin = false;
			let roles = "";

			$.each(data['roles'], function ( k, v ) {
				let cut = v.role_name.substring(5);
				if(cut == "ADMIN") {
					isAdmin = true;
				}
				roles = roles + cut + " ";
				$('#navbar-roles').append(cut + " ");
			});

			if(isAdmin) {
				sidetable.append("<a class=\"nav-link\" href=\"/admin\">Admin</a>" +
								"<a class=\"nav-link active\" href=\"/user\">User</a>")
			} else {
				sidetable.append("<a class=\"nav-link active\" href=\"/user\">User</a>");
			}

			tableBody.append(
					"<tr class=\"align-middle myTableRow\"> <td>" + data.id +
					"</td> <td>" + data.username +
					"</td> <td>" + data.name +
					"</td> <td>" + roles +
					"</td> </tr>");
		});
	}


</script>
</body>
</html>